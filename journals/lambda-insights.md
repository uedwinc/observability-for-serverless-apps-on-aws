# CloudWatch Lambda Insights

CloudWatch Lambda Insights is a powerful extension for understanding the performance of Lambda functions. It provides valuable insights into a range of issues that can affect the performance of Lambda such as memory leaks, identifying high-cost functions, identifying performance impact caused by new versions of Lambda functions, and also understanding latency drivers in the Lambda functions. CloudWatch Lambda Insights allows you to capture diagnostic information before, during, and after function invocation, requiring no code changes.

1. You can enable CloudWatch Lambda Insights from the AWS console. Navigate to the Lambda function and then click on `Configuration` | `Monitoring and operations tools` | `Edit configuration` and then enable `Enhanced monitoring`.

![enable-lambda-insights](/images/enable-lambda-insights.png)

Documentation: https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Lambda-Insights-Getting-Started-console.html

When you enable enhanced monitoring, the Lambda Insights extension will add to the Lambda function as a layer

![insights-extension](/images/insights-extension.png)

> Rather than enabling each from the AWS console, let’s enable CloudWatch Lambda Insights for all the functions in the application deployed using CloudFormation.

2. Edit the CloudFormation template by adding the following YAML code, which adds a new Lambda layer with the Lambda Insights extension with the latest version in the [template-insights-enabled.yaml](../template-insights-enabled.yaml) file:

```yaml
Layers:
  - !Sub "arn:aws:lambda:${AWS::Region}:580247275435:layer:LambdaInsightsExtension:53"

# Make sure to use the latest ARN version
```

Documentation: https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Lambda-Insights-Getting-Started-cloudformation.html

3. Update the CloudFormation stack (on the console) with the new [template file](../template-insights-enabled.yaml) to enable the Lambda extension for all three Lambda functions.

> You can confirm on the Lambda console that all 3 functions are enabled

Enabling Lambda Insights for a Lambda function provides additional metrics related to execution and also provides logs about the Lambda execution. A dashboard view is available out of the box for visualizing performance monitoring for a single function or a performance monitoring view for multiple functions.

Let’s navigate to the Lambda Insights dashboard from the CloudWatch console and understand the metrics and insights available from the Lambda Insights dashboard.

## Single-function view

Single-function view provides detailed performance metrics and logs for a single Lambda function in your AWS account.

1. Let’s navigate to the single-function view. Go to `CloudWatch` | `Insights` | `Lambda Insights`. Select the Lambda function of the serverless application deployed, namely `"serverless-app-getAllItemsFunction-***"`. It provides CPU, memory, and network usage of the Lambda function.

![insights-dash](/images/insights-dash.png)

2. Additionally, it provides a detailed breakdown of the last 1,000 invocations, including initialization duration, overall duration, memory used, CPU time, and network I/O.

![invocations](/images/invocations.png)

You can also view the application logs generated for your function by simply navigating to the second tab labeled `Application logs`

3. Additionally, You can click to view the trace details

![invocate-trace](/images/invocate-trace.png)

## Multifunction view

The multifunction view offers a comprehensive overview of all Lambda functions in your current AWS account and region.

1. Click the function selection dropdown and select `Multi-function`

![multi-function](/images/multi-function.png)

2. In the `Function summary` view (when you scroll down), you can examine the aggregate information for each function, including `Invocations`, `Cold starts`, `Total cost`, `Max. memory`, `CPU time`, and `Network IO` for all Lambda functions. Important metrics to focus on in this are the cost (`Total cost`) and usage metrics (`Max. memory` and `Cold starts`).

![function-summary](/images/function-summary.png)

> While the default out-of-the-box metrics, CloudWatch Lambda Insights metrics, and Lambda logs generated by Lambda Insights provide valuable insight into the performance of an individual Lambda function, they lack context regarding the overall performance of the larger application. The performance metrics generated by each component of the application, such as API Gateway, Lambda, and DynamoDB, offer only a limited understanding of their individual performance, without considering their interconnectedness and impact on the overall application.

> To get a complete picture of how a single function affects the overall system, you need to look at its performance as part of the whole application. This requires enabling tracing for the entire end-to- end application. Enabling tracing for end-to-end applications provides us with the ability to examine correlations and pinpoint potential root causes for a specific request. By doing so, we can gain a deeper understanding of the performance of our application and take action to improve it.